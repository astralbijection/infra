# THIS IS AN AUTO-GENERATED FILE. You should edit /nix/ci.nix instead.
env:
  target_flake: github:${{ github.repository_owner }}/${{ github.repository }}/${{
    inputs.sha || github.sha }}
jobs:
  build-shai-hulud:
    name: Build node shai-hulud
    needs:
      - build-surface-kernel
    runs-on: ubuntu-latest
    steps:
      - uses: cachix/install-nix-action@v16
        with:
          extra_nix_config: 'experimental-features = nix-command flakes

            access-tokens = github.com=${{ secrets.GITHUB_TOKEN }}

            '
          nix_path: nixpkgs=channel:nixos-unstable
      - uses: cachix/cachix-action@v10
        with:
          authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
          name: astralbijection
      - env:
          target_flake: ${{ env.target_flake }}
        name: Build targets
        run: GC_DONT_GC=1 nix build --show-trace "$target_flake#"'nixosConfigurations.shai-hulud.config.system.build.toplevel'
    strategy:
      fail-fast: false
  build-surface-kernel:
    name: Build node surface-kernel
    needs: []
    runs-on: ubuntu-latest
    steps:
      - uses: cachix/install-nix-action@v16
        with:
          extra_nix_config: 'experimental-features = nix-command flakes

            access-tokens = github.com=${{ secrets.GITHUB_TOKEN }}

            '
          nix_path: nixpkgs=channel:nixos-unstable
      - uses: cachix/cachix-action@v10
        with:
          authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
          name: astralbijection
      - env:
          target_flake: ${{ env.target_flake }}
        name: Build targets
        run: GC_DONT_GC=1 nix build --show-trace "$target_flake#"'nixosConfigurations.shai-hulud.config.boot.kernelPackages.kernel'
    strategy:
      fail-fast: false
on:
  push: {}
  schedule:
    - cron: 0 6 * * 6
  workflow_call:
    inputs:
      sha:
        required: true
        type: string
  workflow_dispatch: {}
